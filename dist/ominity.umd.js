(function(c,a){typeof exports=="object"&&typeof module<"u"?a(exports):typeof define=="function"&&define.amd?define(["exports"],a):(c=typeof globalThis<"u"?globalThis:c||self,a(c.Ominity={}))})(this,function(c){"use strict";const a={config:{},init(){document.querySelectorAll("form.ominity-form[data-form]").forEach(e=>{var t;const n=e.getAttribute("data-form")||"",s=e.getAttribute("data-recaptcha"),r=(t=document.querySelector('meta[name="recaptcha-site-key"]'))==null?void 0:t.getAttribute("content");e.addEventListener("submit",d=>{if(e.dispatchEvent(new CustomEvent("form:submit",{detail:{formId:n,recaptchaVersion:s}})),s==="v3"){if(typeof grecaptcha>"u"){console.warn("reCAPTCHA v3 is not loaded.");return}let i=e.querySelector('input[name="g-recaptcha-response"]');i||(i=document.createElement("input"),i.type="hidden",i.name="g-recaptcha-response",e.appendChild(i)),i.value===""&&(d.preventDefault(),grecaptcha.execute(r,{action:"submit"}).then(l=>{i.value=l,a.submitForm(e,n)}))}e.getAttribute("data-role")==="ajax"&&(d.preventDefault(),a.submitForm(e,n))})})},submitForm(e,n){e.getAttribute("data-role")==="ajax"?this.handleFormAjaxSubmit(e,n):e.submit()},handleFormAjaxSubmit(e,n){var r;const s=new FormData(e);fetch(e.action,{method:e.method||"POST",body:s,headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":((r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.getAttribute("content"))||""}}).then(t=>t.json()).then(t=>{if(e.getAttribute("data-recaptcha")==="v3"){const i=e.querySelector('input[name="g-recaptcha-response"]');i&&(i.value="")}e.dispatchEvent(new CustomEvent("form:submitted",{detail:{formId:n,data:t}})),t.success?(e.reset(),e.dispatchEvent(new CustomEvent("form:success",{detail:{formId:n,data:t}}))):t.errors?(a.handleFormErrors(e,t.errors),e.dispatchEvent(new CustomEvent("form:error",{detail:{formId:n,data:t}}))):e.dispatchEvent(new CustomEvent("form:unknown",{detail:{formId:n,data:t}}))}).catch(t=>{console.error("Form submit error:",t),e.dispatchEvent(new CustomEvent("form:fail",{detail:{formId:n,error:t}}))})},handleFormErrors(e,n){e.querySelectorAll(".has-validation").forEach(s=>s.classList.remove("has-validation")),e.querySelectorAll(".is-invalid").forEach(s=>s.classList.remove("is-invalid")),e.querySelectorAll(".invalid-feedback").forEach(s=>s.remove()),Object.entries(n).forEach(([s,r])=>{const t=r[0];let d=`[name="${s}"], [name="${s}[]"]`;if(s.includes(".")){const l=s.replace(/\./g,"][");d+=`, [name="${l}"]`}const i=e.querySelectorAll(d);if(i.length>0){let l=!1;if(i.forEach(o=>{if(o.type==="hidden"||o.offsetParent===null)a.showToast(t,"danger"),l=!0;else{o.classList.add("is-invalid");const u=o.closest(".input-group");u&&u.classList.add("has-validation")}}),!l){const o=i[0];o.type==="checkbox"||o.type==="radio"?i[i.length-1].insertAdjacentHTML("afterend",`<div class="invalid-feedback">${t}</div>`):o.insertAdjacentHTML("afterend",`<div class="invalid-feedback">${t}</div>`)}}else a.showToast(t,"danger")})},showToast(e,n="danger"){typeof a.config.toastHandler=="function"?a.config.toastHandler({type:n,message:e}):typeof window.$<"u"&&typeof window.$.fn.showToast=="function"?window.$.fn.showToast({type:n,title:e}):console.warn(`[${n.toUpperCase()}] ${e}`)}};window.OminityForms=a,c.OminityForms=a,Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})});
