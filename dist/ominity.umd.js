(function(c,s){typeof exports=="object"&&typeof module<"u"?s(exports):typeof define=="function"&&define.amd?define(["exports"],s):(c=typeof globalThis<"u"?globalThis:c||self,s(c.Ominity={}))})(this,function(c){"use strict";const s={config:{},init(){document.querySelectorAll("form.ominity-form[data-form]").forEach(e=>{var t;const n=e.getAttribute("data-form")||"",a=e.getAttribute("data-recaptcha"),r=(t=document.querySelector('meta[name="recaptcha-site-key"]'))==null?void 0:t.getAttribute("content");e.addEventListener("submit",l=>{if(e.dispatchEvent(new CustomEvent("form:submit",{detail:{formId:n,recaptchaVersion:a}})),a==="v3"){if(typeof grecaptcha>"u"){console.warn("reCAPTCHA v3 is not loaded.");return}let i=e.querySelector('input[name="g-recaptcha-response"]');i||(i=document.createElement("input"),i.type="hidden",i.name="g-recaptcha-response",e.appendChild(i)),i.value===""&&(l.preventDefault(),grecaptcha.execute(r,{action:"submit"}).then(d=>{i.value=d,s.submitForm(e,n)}))}e.getAttribute("data-role")==="ajax"&&(l.preventDefault(),s.submitForm(e,n))})})},submitForm(e,n){e.getAttribute("data-role")==="ajax"?this.handleFormAjaxSubmit(e,n):e.submit()},handleFormAjaxSubmit(e,n){var r;const a=new FormData(e);fetch(e.action,{method:e.method||"POST",body:a,headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":((r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.getAttribute("content"))||""}}).then(t=>t.json()).then(t=>{if(e.getAttribute("data-recaptcha")==="v3"){const i=e.querySelector('input[name="g-recaptcha-response"]');i&&(i.value="")}e.dispatchEvent(new CustomEvent("form:submitted",{detail:{formId:n,data:t}})),t.success?(e.reset(),e.dispatchEvent(new CustomEvent("form:success",{detail:{formId:n,data:t}}))):t.errors?(s.handleFormErrors(e,t.errors),e.dispatchEvent(new CustomEvent("form:error",{detail:{formId:n,data:t}}))):e.dispatchEvent(new CustomEvent("form:unknown",{detail:{formId:n,data:t}}))}).catch(t=>{console.error("Form submit error:",t),e.dispatchEvent(new CustomEvent("form:fail",{detail:{formId:n,error:t}}))})},handleFormErrors(e,n){e.querySelectorAll(".has-validation").forEach(a=>a.classList.remove("has-validation")),e.querySelectorAll(".is-invalid").forEach(a=>a.classList.remove("is-invalid")),e.querySelectorAll(".invalid-feedback").forEach(a=>a.remove()),Object.entries(n).forEach(([a,r])=>{const t=r[0];let l=`[name="${a}"], [name="${a}[]"]`;if(a.includes(".")){const d=a.replace(/\./g,"][");l+=`, [name="${d}"]`}const i=e.querySelectorAll(l);if(i.length>0){let d=!1;if(i.forEach(o=>{if(o.type==="hidden"||o.offsetParent===null)s.showToast(t,"danger"),d=!0;else{o.classList.add("is-invalid");const u=o.closest(".input-group");u&&u.classList.add("has-validation")}}),!d){const o=i[0];o.type==="checkbox"||o.type==="radio"?i[i.length-1].insertAdjacentHTML("afterend",`<div class="invalid-feedback">${t}</div>`):o.insertAdjacentHTML("afterend",`<div class="invalid-feedback">${t}</div>`)}}else s.showToast(t,"danger")})},showToast(e,n="danger"){typeof s.config.toastHandler=="function"?s.config.toastHandler({type:n,message:e}):typeof window.$<"u"&&typeof window.$.fn.showToast=="function"?window.$.fn.showToast({type:n,title:e}):console.warn(`[${n.toUpperCase()}] ${e}`)}};c.OminityForms=s,Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})});
