(function(c,s){typeof exports=="object"&&typeof module<"u"?s(exports):typeof define=="function"&&define.amd?define(["exports"],s):(c=typeof globalThis<"u"?globalThis:c||self,s(c.Ominity={}))})(this,function(c){"use strict";const s={config:{},init(){document.querySelectorAll("form.ominity-form[data-form]").forEach(e=>{var n;const i=e.getAttribute("data-form")||"",a=e.getAttribute("data-recaptcha"),r=(n=document.querySelector('meta[name="recaptcha-site-key"]'))==null?void 0:n.getAttribute("content");e.addEventListener("submit",l=>{if(e.dispatchEvent(new CustomEvent("form:submit",{detail:{formId:i,recaptchaVersion:a}})),a==="v3"){if(typeof grecaptcha>"u"){console.warn("reCAPTCHA v3 is not loaded.");return}let t=e.querySelector('input[name="g-recaptcha-response"]');t||(t=document.createElement("input"),t.type="hidden",t.name="g-recaptcha-response",e.appendChild(t)),t.value===""&&(l.preventDefault(),grecaptcha.ready(()=>{grecaptcha.execute(r,{action:"submit"}).then(d=>{t.value=d,s.submitForm(e,i)})}))}else e.getAttribute("data-role")==="ajax"&&(l.preventDefault(),s.submitForm(e,i))})})},submitForm(e,i){e.getAttribute("data-role")==="ajax"?this.handleFormAjaxSubmit(e,i):e.submit()},handleFormAjaxSubmit(e,i){var r;const a=new FormData(e);fetch(e.action,{method:e.method||"POST",body:a,headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":((r=document.querySelector('meta[name="csrf-token"]'))==null?void 0:r.getAttribute("content"))||""}}).then(n=>n.json()).then(n=>{if(e.getAttribute("data-recaptcha")==="v3"){const t=e.querySelector('input[name="g-recaptcha-response"]');t&&(t.value="")}e.dispatchEvent(new CustomEvent("form:submitted",{detail:{formId:i,data:n}})),n.success?(e.querySelectorAll(".has-validation").forEach(t=>t.classList.remove("has-validation")),e.querySelectorAll(".is-invalid").forEach(t=>t.classList.remove("is-invalid")),e.querySelectorAll(".invalid-feedback").forEach(t=>t.remove()),e.reset(),e.dispatchEvent(new CustomEvent("form:success",{detail:{formId:i,data:n}}))):n.errors?(s.handleFormErrors(e,n.errors),e.dispatchEvent(new CustomEvent("form:error",{detail:{formId:i,data:n}}))):e.dispatchEvent(new CustomEvent("form:unknown",{detail:{formId:i,data:n}}))}).catch(n=>{console.error("Form submit error:",n),e.dispatchEvent(new CustomEvent("form:fail",{detail:{formId:i,error:n}}))})},handleFormErrors(e,i){e.querySelectorAll(".has-validation").forEach(a=>a.classList.remove("has-validation")),e.querySelectorAll(".is-invalid").forEach(a=>a.classList.remove("is-invalid")),e.querySelectorAll(".invalid-feedback").forEach(a=>a.remove()),Object.entries(i).forEach(([a,r])=>{const n=r[0];let l=`[name="${a}"], [name="${a}[]"]`;if(a.includes(".")){const d=a.replace(/\./g,"][");l+=`, [name="${d}"]`}const t=e.querySelectorAll(l);if(t.length>0){let d=!1;if(t.forEach(o=>{if(o.type==="hidden"||o.offsetParent===null)s.showToast(n,"danger"),d=!0;else{o.classList.add("is-invalid");const u=o.closest(".input-group");u&&u.classList.add("has-validation")}}),!d){const o=t[0];o.type==="checkbox"||o.type==="radio"?t[t.length-1].insertAdjacentHTML("afterend",`<div class="invalid-feedback">${n}</div>`):o.insertAdjacentHTML("afterend",`<div class="invalid-feedback">${n}</div>`)}}else s.showToast(n,"danger")})},showToast(e,i="danger"){typeof s.config.toastHandler=="function"?s.config.toastHandler({type:i,message:e}):typeof window.$<"u"&&typeof window.$.fn.showToast=="function"?window.$.fn.showToast({type:i,title:e}):console.warn(`[${i.toUpperCase()}] ${e}`)}};window.OminityForms=s,c.OminityForms=s,Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})});
